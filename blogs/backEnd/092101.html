<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nginx学习笔记整理 | cookie&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/myBlog/favicon.ico">
    <meta name="description" content="Be the best version of you">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/myBlog/assets/css/0.styles.6db6a465.css" as="style"><link rel="preload" href="/myBlog/assets/js/app.31a2d7bd.js" as="script"><link rel="preload" href="/myBlog/assets/js/3.76e8c894.js" as="script"><link rel="preload" href="/myBlog/assets/js/1.8243c5f8.js" as="script"><link rel="preload" href="/myBlog/assets/js/14.1a53c00f.js" as="script"><link rel="prefetch" href="/myBlog/assets/js/10.c3dbc9ec.js"><link rel="prefetch" href="/myBlog/assets/js/11.bd1523ae.js"><link rel="prefetch" href="/myBlog/assets/js/12.e8db5886.js"><link rel="prefetch" href="/myBlog/assets/js/13.51291677.js"><link rel="prefetch" href="/myBlog/assets/js/15.5d446e8e.js"><link rel="prefetch" href="/myBlog/assets/js/16.852e8ece.js"><link rel="prefetch" href="/myBlog/assets/js/17.71334f65.js"><link rel="prefetch" href="/myBlog/assets/js/18.2d358b1d.js"><link rel="prefetch" href="/myBlog/assets/js/19.eb648a5f.js"><link rel="prefetch" href="/myBlog/assets/js/20.c0f515ef.js"><link rel="prefetch" href="/myBlog/assets/js/21.760f2379.js"><link rel="prefetch" href="/myBlog/assets/js/22.9fcf09ad.js"><link rel="prefetch" href="/myBlog/assets/js/23.b6fed393.js"><link rel="prefetch" href="/myBlog/assets/js/24.344aa828.js"><link rel="prefetch" href="/myBlog/assets/js/25.584d0567.js"><link rel="prefetch" href="/myBlog/assets/js/26.62ba3645.js"><link rel="prefetch" href="/myBlog/assets/js/4.37ef1cf5.js"><link rel="prefetch" href="/myBlog/assets/js/5.c19f1590.js"><link rel="prefetch" href="/myBlog/assets/js/6.8ce649b0.js"><link rel="prefetch" href="/myBlog/assets/js/7.8684bd4a.js"><link rel="prefetch" href="/myBlog/assets/js/8.79c8f128.js"><link rel="prefetch" href="/myBlog/assets/js/9.b4b78921.js">
    <link rel="stylesheet" href="/myBlog/assets/css/0.styles.6db6a465.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-2d5f533b><div data-v-2d5f533b><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-2d5f533b data-v-2d5f533b><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-2d5f533b data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>cookie's blog</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>cookie-fzx</span>
            
          <span data-v-64685f0e>2017 - </span>
          2020
        </a></span></div></div> <div class="hide" data-v-2d5f533b><header class="navbar" data-v-2d5f533b><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/myBlog/" class="home-link router-link-active"><img src="/myBlog/logo.png" alt="cookie's blog" class="logo"> <span class="site-name">cookie's blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myBlog/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/categories/Vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/backEnd/" class="nav-link"><i class="iconfont undefined"></i>
  backEnd
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/style/" class="nav-link"><i class="iconfont undefined"></i>
  style
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/tool/" class="nav-link"><i class="iconfont undefined"></i>
  tool
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/frontEnd/" class="nav-link"><i class="iconfont undefined"></i>
  frontEnd
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/language/" class="nav-link"><i class="iconfont undefined"></i>
  language
</a></li></ul></div></div><div class="nav-item"><a href="/myBlog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/myBlog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Profile
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/docs/theme-reco/" class="nav-link"><i class="iconfont undefined"></i>
  my-docs
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zuxian" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/image_fzx" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSND
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://fuzuxian.fun/images/%E8%A7%86%E9%A2%91%E5%8F%B7.jpg" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-wechat"></i>
  vlog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://zuxian.gitee.io/album/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-account"></i>
  album
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-2d5f533b></div> <aside class="sidebar" data-v-2d5f533b><div class="personal-info-wrapper" data-v-ca798c94 data-v-2d5f533b><img src="/myBlog/avatar.png" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    cookie-fzx
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>11</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>9</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/myBlog/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/categories/Vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/backEnd/" class="nav-link"><i class="iconfont undefined"></i>
  backEnd
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/style/" class="nav-link"><i class="iconfont undefined"></i>
  style
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/tool/" class="nav-link"><i class="iconfont undefined"></i>
  tool
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/frontEnd/" class="nav-link"><i class="iconfont undefined"></i>
  frontEnd
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/language/" class="nav-link"><i class="iconfont undefined"></i>
  language
</a></li></ul></div></div><div class="nav-item"><a href="/myBlog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/myBlog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Profile
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/docs/theme-reco/" class="nav-link"><i class="iconfont undefined"></i>
  my-docs
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zuxian" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/image_fzx" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSND
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://fuzuxian.fun/images/%E8%A7%86%E9%A2%91%E5%8F%B7.jpg" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-wechat"></i>
  vlog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://zuxian.gitee.io/album/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-account"></i>
  album
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><a href="/myBlog/blogs/backEnd/092101.html" aria-current="page" class="active sidebar-link">nginx学习笔记整理</a></li><li><a href="/myBlog/blogs/backEnd/121501.html" class="sidebar-link">手动编译部署前端项目</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>nginx学习笔记整理</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>cookie-fzx</span>
            
          <span data-v-64685f0e>2017 - </span>
          2020
        </a></span></div></div> <div data-v-2d5f533b><main class="page" style="padding-right:0;"><div class="page-title" style="display:none;"><h1 class="title">nginx学习笔记整理</h1> <div data-v-3b7f5bdf><i class="iconfont reco-account" data-v-3b7f5bdf><span data-v-3b7f5bdf>cookie-fzx</span></i> <i class="iconfont reco-date" data-v-3b7f5bdf><span data-v-3b7f5bdf>2019-09-21</span></i> <!----> <i class="iconfont reco-tag tags" data-v-3b7f5bdf><span class="tag-item" data-v-3b7f5bdf>nginx</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><p>目录</p> <p></p><div class="table-of-contents"><ul><li><a href="#_1-安装-nginx">1.  安装 nginx</a></li><li><a href="#_2-nginx配置文件">2.  nginx配置文件</a></li><li><a href="#_3-nginx的正向代理和反向代理">3.  Nginx的正向代理和反向代理</a></li><li><a href="#_4-关于nginx的location路径映射">4.  关于Nginx的location路径映射</a></li><li><a href="#_5-nginx负载均衡-upstream">5.  Nginx负载均衡：upstream</a></li><li><a href="#_6-nginx动静分离">6.  Nginx动静分离</a></li><li><a href="#_7-nginx集群">7.  Nginx集群</a></li><li><a href="#_8-nginx之前端相关配置">8.  Nginx之前端相关配置</a></li><li><a href="#_9-nginx简单总结">9.  Nginx简单总结</a></li></ul></div><p></p> <hr> <p><a href="https://www.bilibili.com/video/BV1W54y1z7GM" target="_blank" rel="noopener noreferrer">b站地址--nginx<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://blog.csdn.net/m0_49558851/article/details/107786372" target="_blank" rel="noopener noreferrer">nginx笔记<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.w3cschool.cn/nginx/" target="_blank" rel="noopener noreferrer">nginx教程--w3c<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.runoob.com/w3cnote/nginx-setup-intro.html" target="_blank" rel="noopener noreferrer">nginx教程--菜鸟教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <hr> <h2 id="_1-安装-nginx"><a href="#_1-安装-nginx" class="header-anchor">#</a> 1.  安装 nginx</h2> <h4 id="_1-1-虚拟机安装docker"><a href="#_1-1-虚拟机安装docker" class="header-anchor">#</a> 1.1    虚拟机安装docker</h4> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code><span class="token comment"># root账户登录，查看内核版本--虚拟机装的Centos7，linux 3.10内核</span>
uname <span class="token operator">-</span>a

<span class="token comment"># 把yum包更新到最新</span>
yum update

<span class="token comment"># 设置yum源</span>
yum<span class="token operator">-</span>config<span class="token operator">-</span>manager <span class="token operator">--</span><span class="token function">add-repo</span> http:<span class="token operator">/</span><span class="token operator">/</span>download<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>com<span class="token operator">/</span>linux<span class="token operator">/</span>centos<span class="token operator">/</span>docker<span class="token operator">-</span>ce<span class="token punctuation">.</span>repo
yum<span class="token operator">-</span>config<span class="token operator">-</span>manager <span class="token operator">--</span><span class="token function">add-repo</span> http:<span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>docker<span class="token operator">-</span>ce<span class="token operator">/</span>linux<span class="token operator">/</span>centos<span class="token operator">/</span>docker<span class="token operator">-</span>ce<span class="token punctuation">.</span>repo

<span class="token comment"># 使用官方安装脚本自动安装</span>
curl <span class="token operator">-</span>fsSL https:<span class="token operator">/</span><span class="token operator">/</span>get<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>com<span class="token operator">/</span>  <span class="token punctuation">|</span>  sh

<span class="token comment"># 遇到问题： No Presto metadata available for docker-ce-stable</span>
yum install docker<span class="token operator">-</span>ce <span class="token operator">-</span>y

<span class="token comment"># 重新 执行 Docker 安装脚本</span>
curl <span class="token operator">-</span>fsSL https:<span class="token operator">/</span><span class="token operator">/</span>get<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>com<span class="token operator">/</span>  <span class="token punctuation">|</span>  sh

<span class="token comment"># </span>
sudo docker version

<span class="token comment"># 启动 Docker 进程</span>
sudo service docker <span class="token function">start</span>

<span class="token comment"># 验证 docker 是否安装成功并在容器中执行一个测试的镜像</span>
sudo docker run hello<span class="token operator">-</span>world

<span class="token comment"># ------------- 增加用户 --------------------------------</span>
<span class="token comment"># 增加docker用户组</span>
sudo groupadd docker
<span class="token comment">#  增加名字为 cookie  的用户</span>
sudo gpasswd <span class="token operator">-</span>a cookie docker
<span class="token comment"># docker 服务重启</span>
sudo service docker restart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h4 id="_2-1-docker下安装nginx"><a href="#_2-1-docker下安装nginx" class="header-anchor">#</a> 2.1 docker下安装nginx</h4> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code><span class="token comment">#在/opt目录下创建docker_nginx目录</span>
cd <span class="token operator">/</span>opt
mkdir docker_nginx
<span class="token comment">#创建docker-compose.yml文件并编写下面的内容,保存退出</span>
vim docker<span class="token operator">-</span>compose<span class="token punctuation">.</span>yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>version: <span class="token string">'3.1'</span>
services:
  nginx:
    restart: always
    image: daocloud<span class="token punctuation">.</span>io<span class="token operator">/</span>library<span class="token operator">/</span>nginx:latest
    container_name: nginx
    ports:
      <span class="token operator">-</span> 80:80
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>执行 <code>docker-compose up -d</code></p> <p>打开网址：    <code>92.168.2.100:80</code></p> <hr> <hr> <h2 id="_2-nginx配置文件"><a href="#_2-nginx配置文件" class="header-anchor">#</a> 2.  nginx配置文件</h2> <h4 id="_2-1-nginx-配置文件和目录"><a href="#_2-1-nginx-配置文件和目录" class="header-anchor">#</a> 2.1  Nginx 配置文件和目录</h4> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code><span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>nginx<span class="token punctuation">.</span>conf 		核心配置文件
<span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token operator">/</span>default<span class="token punctuation">.</span>conf 		默认http服务器配置文件

<span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>fastcgi_params 	fastcgi配置
<span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>scgi_params 		scgi配置
<span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>uwsgi_params 	uwsgi配置
<span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>mime<span class="token punctuation">.</span>types 	设置HTTP协议的Content<span class="token operator">-</span><span class="token function">Type</span>与扩展名对应关系的文件
<span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>modules 		基本共享库和内核模块

<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>cache<span class="token operator">/</span>nginx 	Nginx的缓存目录
<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>nginx 		Nginx的日志目录
<span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>nginx 	可执行命令
<span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>nginx<span class="token operator">-</span>debug 	调试执行可执行命令

<span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>doc<span class="token operator">/</span>nginx<span class="token operator">-</span>1<span class="token punctuation">.</span>18<span class="token punctuation">.</span>0 	帮助文档
<span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>doc<span class="token operator">/</span>nginx<span class="token operator">-</span>1<span class="token punctuation">.</span>18<span class="token punctuation">.</span>0<span class="token operator">/</span>COPYRIGHT 	版权声明
<span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>man<span class="token operator">/</span>man8<span class="token operator">/</span>nginx<span class="token punctuation">.</span>8<span class="token punctuation">.</span>gz 	手册

<span class="token comment"># 这四个文件是用来配置守护进程管理的</span>
<span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>nginx<span class="token operator">-</span>debug<span class="token punctuation">.</span>service
<span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>nginx<span class="token punctuation">.</span>service
<span class="token operator">/</span>etc<span class="token operator">/</span>sysconfig<span class="token operator">/</span>nginx
<span class="token operator">/</span>etc<span class="token operator">/</span>sysconfig<span class="token operator">/</span>nginx<span class="token operator">-</span>debug

<span class="token comment"># 这三个文件是编码映射文件，因为作者是俄国人</span>
<span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>koi<span class="token operator">-</span>utf
<span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>koi<span class="token operator">-</span>win
<span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>win<span class="token operator">-</span>utf 	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>==常用命令==</p> <ul><li>启动nginx:  <code>service nginx start</code></li> <li>检查nginx配置文件是否有语法错误：<code>nginx -t</code></li> <li>关闭nginx:  <code>nginx -s stop</code></li> <li>重启nginx:  <code>nginx -s reload</code></li></ul> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code><span class="token comment"># 查看容器id</span>
docker <span class="token function">ps</span>

<span class="token comment">#查看当前nginx的配置需要【进入docker容器中】</span>
docker exec <span class="token operator">-</span>it 容器id bash

root@37136a6bbb58:<span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token comment"># ls</span>
conf<span class="token punctuation">.</span>d	fastcgi_params	koi<span class="token operator">-</span>utf  koi<span class="token operator">-</span>win  mime<span class="token punctuation">.</span>types  modules  nginx<span class="token punctuation">.</span>conf  scgi_params	uwsgi_params  win<span class="token operator">-</span>utf

<span class="token comment">#进入容器后</span>
cd <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>
<span class="token function">cat</span> nginx<span class="token punctuation">.</span>conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_2-2-核心配置文件nginx-conf文件"><a href="#_2-2-核心配置文件nginx-conf文件" class="header-anchor">#</a> 2.2  核心配置文件nginx.conf文件</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>user  nginx;
worker_processes  1;

error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;
<span class="token comment"># 以上为全局块</span>
<span class="token comment"># worker_processes的数值越大，Nginx的并发能力就越强</span>
<span class="token comment"># error_log代表Nginx错误日志存放的位置</span>
<span class="token comment"># pid是Nginx运行的一个标识</span>

events <span class="token punctuation">{</span>
    worker_connections  1024;
<span class="token punctuation">}</span>
<span class="token comment"># events块</span>
<span class="token comment"># worker_connections的数值越大，Nginx的并发能力就越强</span>

http <span class="token punctuation">{</span>
    include       /etc/nginx/mime.types;
    default_type  application/octet<span class="token punctuation">-</span>stream;

    access_log  /var/log/nginx/access.log  main;
    sendfile        on;
    keepalive_timeout  65;
    
    <span class="token comment">#include /etc/nginx/conf.d/*.conf;</span>
    server <span class="token punctuation">{</span>
    	listen       80;
    	listen  <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>80;
    	server_name  localhost;

   		location / <span class="token punctuation">{</span>
        	root   /usr/share/nginx/html;
       		index  index.html index.htm;
    	<span class="token punctuation">}</span>
    	<span class="token comment"># location块</span>
		<span class="token comment"># root:将接受到的请求根据/usr/share/nginx/html去查找静态资源</span>
		<span class="token comment"># index:默认去上述的路径中找到index.html或index.htm</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># server块</span>
	<span class="token comment"># listen代表Nginx监听的端口号</span>
	<span class="token comment"># server_name代表Nginx接受请求的IP</span>
<span class="token punctuation">}</span>
<span class="token comment"># http块</span>
<span class="token comment"># include代表引入一个外部文件</span>
<span class="token comment"># include  /etc/nginx/mime.types;  存放着大量媒体类型---设置HTTP协议的Content-Type与扩展名对应关系的文件</span>
<span class="token comment">#include /etc/nginx/conf.d/*.conf;	引入了conf.d下以.conf为结尾的配置文件</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h4 id="_2-3-修改docker-compose文件"><a href="#_2-3-修改docker-compose文件" class="header-anchor">#</a> 2.3  修改docker-compose文件</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">#退出容器\关闭容器</span>
exit

<span class="token comment"># 关闭 nginx </span>
docker<span class="token punctuation">-</span>compose down

<span class="token comment"># 修改 docker-compose.yml</span>
vi docker<span class="token punctuation">-</span>compose.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>增加数据卷
volumes:
- /opt/docker_nginx/conf.d/:/etc/nginx/conf.d</p> <p>当前/opt/docker_nginx/目录下的 conf.d 映射到  /etc/nginx 目录下的 conf.d</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.1'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span> 
  <span class="token key atrule">nginx</span><span class="token punctuation">:</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">image</span><span class="token punctuation">:</span> daocloud.io/library/nginx<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">ports</span><span class="token punctuation">:</span> 
      <span class="token punctuation">-</span> <span class="token datetime number">80:80</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /opt/docker_nginx/conf.d/<span class="token punctuation">:</span>/etc/nginx/conf.d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">#重新构建容器</span>
docker<span class="token punctuation">-</span>compose bulid
<span class="token comment">#重新启动容器</span>
docker<span class="token punctuation">-</span>compose up <span class="token punctuation">-</span>d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这时我们再次访问80端口是访问不到的，因为我们映射了数据卷之后还没有编写server块中的内容</p> <p>我们在/opt/docker_nginx/conf.d下新建default.conf，并插入如下内容</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>server <span class="token punctuation">{</span>
  listen  80;
  listen  <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>80;
  server_name  localhost;

  location / <span class="token punctuation">{</span>
    root /usr/share/nginx/html;
    index  index.html  index.html;
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>重启nginx： <code>docker-compose restart</code></p> <hr> <hr> <h2 id="_3-nginx的正向代理和反向代理"><a href="#_3-nginx的正向代理和反向代理" class="header-anchor">#</a> 3.  Nginx的正向代理和反向代理</h2> <h4 id="_3-1-正向代理和反向代理-知识点"><a href="#_3-1-正向代理和反向代理-知识点" class="header-anchor">#</a> 3.1   正向代理和反向代理---知识点</h4> <blockquote><p>正向代理：
1.正向代理服务是由客户端设立的
2.客户端了解代理服务器和目标服务器都是谁
3.帮助咱们实现突破访问权限，提高访问的速度，对目标服务器隐藏客户端的ip地址</p></blockquote> <blockquote><p>反向代理：
1.反向代理服务器是配置在服务端的
2.客户端不知道访问的到底是哪一台服务器
3.达到负载均衡，并且可以隐藏服务器真正的ip地址</p></blockquote> <h4 id="_3-1-nginx实现反向代理-案例"><a href="#_3-1-nginx实现反向代理-案例" class="header-anchor">#</a> 3.1   Nginx实现反向代理  ---  案例</h4> <p>步骤：</p> <p>准备一个目标服务器
启动tomcat服务器
编写nginx的配置文件(/opt/docker_nginx/conf.d/default.conf)，通过Nginx访问到tomcat服务器</p> <p>准备tomcat服务器</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 8080<span class="token punctuation">:</span>8080 <span class="token punctuation">-</span><span class="token punctuation">-</span>name tomcat  daocloud.io/library/tomcat<span class="token punctuation">:</span>8.5.15<span class="token punctuation">-</span>jre8
<span class="token comment">#或者已经下载了tomcat镜像</span>
docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 8080<span class="token punctuation">:</span>8080 <span class="token punctuation">-</span><span class="token punctuation">-</span>name tomcat 镜像的标识

<span class="token comment">#添加数据卷</span>
docker run <span class="token punctuation">-</span>it <span class="token punctuation">-</span>v /宿主机绝对目录<span class="token punctuation">:</span>/容器内目录 镜像名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>default.conf文件内容如下</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>server <span class="token punctuation">{</span>
    listen       80;
    listen  <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>80;
    server_name  localhost;

	<span class="token comment"># 基于反向代理访问到tomcat服务器</span>
    location / <span class="token punctuation">{</span>
        proxy_pass http<span class="token punctuation">:</span>//<span class="token punctuation">{</span>$本机IP<span class="token punctuation">}</span><span class="token punctuation">:</span>8080/;
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>重启nginx： <code>docker-compose restart</code></p> <p>这时我们访问80端口可以看到8080端口tomcat的默认首页</p> <hr> <hr> <h2 id="_4-关于nginx的location路径映射"><a href="#_4-关于nginx的location路径映射" class="header-anchor">#</a> 4.  关于Nginx的location路径映射</h2> <h4 id="_4-1-location路径映射-知识点"><a href="#_4-1-location路径映射-知识点" class="header-anchor">#</a> 4.1   location路径映射---知识点</h4> <p>优先级关系：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>(location = ) <span class="token punctuation">&gt;</span> 
	(location /xxx/yyy/zzz) <span class="token punctuation">&gt;</span> 
		(location ^~) <span class="token punctuation">&gt;</span> 
			(location ~<span class="token punctuation">,</span>~<span class="token important">*)</span> <span class="token punctuation">&gt;</span> 
				(location /起始路径) <span class="token punctuation">&gt;</span> 
					(location /)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol><li>==精准匹配==：主机名后面不能带任何字符串</li></ol> <p>例如www.baidu.com不能是www.baidu.com/id=xxx</p> <p><code>location / { }</code></p> <ol start="2"><li>==通用匹配==：匹配所有以/xxx开头的路径</li></ol> <p>例如127.0.0.1:8080/xxx	xxx可以为空，为空则和=匹配一样</p> <p><code>location /xxx { }</code></p> <ol start="3"><li>==正则匹配==：匹配所有以/xxx开头的路径</li></ol> <p><code>location ~ /xxx {	 }</code></p> <ol start="4"><li>==匹配开头路径----异或==：匹配所有以/xxx/xx开头的路径</li></ol> <p><code>location ^~ /xxx/xx { }</code></p> <ol start="5"><li>==匹配结尾路径==： 匹配以.gif、.jpg或者.png结尾的路径</li></ol> <p><code>location ~* \.(gif/jpg/png)$ { }</code></p> <p>== root与alias的区别==</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>
 server <span class="token punctuation">{</span>
    listen       80;
    server_name  localhost;
    location / <span class="token punctuation">{</span>
     <span class="token comment">#root   html;</span>
    alias  /data/admin/;
    index  index.html index.htm;
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>访问 <code>192.12.13.1/data/admin/index.html</code></p> <p>root的处理结果是：root路径＋location路径
alias的处理结果是：使用alias路径替换location路径</p> <p><font color="green">  alias后面必须要用“/”结束，否则会找不到文件的！！而root则可有可无~~ </font></p> <h4 id="_4-2-location路径映射-案例"><a href="#_4-2-location路径映射-案例" class="header-anchor">#</a> 4.2   location路径映射 --- 案例</h4> <p>修改/opt/docker_nginx/conf.d/default.conf  如下， <font color="blue"> 优先级 越高  越写在前面   </font>  。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>server <span class="token punctuation">{</span>
    listen       80;
    listen  <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>80;
    server_name  localhost;

	location /index <span class="token punctuation">{</span>
        proxy_pass http<span class="token punctuation">:</span>//<span class="token punctuation">{</span>$本机IP<span class="token punctuation">}</span><span class="token punctuation">:</span>8081/;	<span class="token comment">#tomcat首页</span>
    <span class="token punctuation">}</span>
	location ^~ /CR/ <span class="token punctuation">{</span>
        proxy_pass http<span class="token punctuation">:</span>//<span class="token punctuation">{</span>$本机IP<span class="token punctuation">}</span><span class="token punctuation">:</span>8080/CR/;	<span class="token comment">#毕设前台首页</span>
    <span class="token punctuation">}</span>
    location / <span class="token punctuation">{</span>
        proxy_pass http<span class="token punctuation">:</span>//<span class="token punctuation">{</span>$本机IP<span class="token punctuation">}</span><span class="token punctuation">:</span>8080/CRAdmin/;	<span class="token comment">#毕设后台首页</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>重启nginx： <code>docker-compose restart</code></p> <p>访问<code>{$本机IP}/index</code>可以进入tomcat首页
访问<code>{$本机IP}/CR/XXX</code>可以进入毕设前台首页
访问<code>{$本机IP}</code>或者<code>{$本机IP}:80</code>可以进入毕设后台首页</p> <hr> <hr> <h2 id="_5-nginx负载均衡-upstream"><a href="#_5-nginx负载均衡-upstream" class="header-anchor">#</a> 5.  Nginx负载均衡：upstream</h2> <p>Nginx为我们默认提供了三种负载均衡的策略：</p> <ol><li>轮询：
将客户端发起的请求，平均分配给每一台服务器</li> <li>权重：
将客户端的请求，根据服务器的权重值不同，分配不同的数量</li> <li>ip_hash:
基于发起请求的客户端的ip地址不同，他始终会将请求发送到指定的服务器上
就是说如果这个客户端的请求的ip地址不变，那么处理请求的服务器将一直是同一个</li></ol> <h4 id="_5-1-轮询-实现nginx轮询负载均衡机制"><a href="#_5-1-轮询-实现nginx轮询负载均衡机制" class="header-anchor">#</a> 5.1，轮询：实现Nginx轮询负载均衡机制</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>upstream my_serverName<span class="token punctuation">{</span>
    server <span class="token punctuation">{</span>$本机IP<span class="token punctuation">}</span><span class="token punctuation">:</span>8080;
    server <span class="token punctuation">{</span>$本机IP<span class="token punctuation">}</span><span class="token punctuation">:</span>8081;
<span class="token punctuation">}</span>
server <span class="token punctuation">{</span>
    listen       80;
    listen  <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>80;
    server_name  localhost;

	location / <span class="token punctuation">{</span>
        proxy_pass   http<span class="token punctuation">:</span>//my_serverName/;	  <span class="token comment">#tomcat首页</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span>
<span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">-</span><span class="token punctuation">-</span>  总结  <span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">-</span>
upstream 名字<span class="token punctuation">{</span>
    server ip<span class="token punctuation">:</span>port;
    server 域名<span class="token punctuation">:</span>端口;
<span class="token punctuation">}</span>
server <span class="token punctuation">{</span>
    listen       80;
    listen  <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>80;
    server_name  localhost;

	location / <span class="token punctuation">{</span>
        proxy_pass http<span class="token punctuation">:</span>//<span class="token punctuation">{</span>$upstream的名字<span class="token punctuation">}</span>/;	
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>1， upstream 声明应该在 server  之前；
2， upstream 的 实例名字 最好不要有下划线_</p> <p>重启nginx： <code>docker-compose restart</code></p> <p>多次刷新<code>{$本机IP}</code>页面，根据版本号我们可以发现我们进入的是不同的tomcat</p> <h4 id="_5-2-权重-在配置文件中upstream块中加上weight"><a href="#_5-2-权重-在配置文件中upstream块中加上weight" class="header-anchor">#</a> 5.2，权重：在配置文件中upstream块中加上weight</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>upstream my_server<span class="token punctuation">{</span>
    server <span class="token punctuation">{</span>$本机IP<span class="token punctuation">}</span><span class="token punctuation">:</span>8080   weight=10;
    server <span class="token punctuation">{</span>$本机IP<span class="token punctuation">}</span><span class="token punctuation">:</span>8081   weight=2;
<span class="token punctuation">}</span>
server <span class="token punctuation">{</span>
    listen       80;
    listen  <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>80;
    server_name  localhost;

	location / <span class="token punctuation">{</span>
        proxy_pass http<span class="token punctuation">:</span>//<span class="token punctuation">{</span>$upstream的名字<span class="token punctuation">}</span>/;	<span class="token comment">#tomcat首页</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_5-3-ip-hash-在配置文件upstream块中加上ip-hash"><a href="#_5-3-ip-hash-在配置文件upstream块中加上ip-hash" class="header-anchor">#</a> 5.3， ip_hash：在配置文件upstream块中加上ip_hash</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>upstream my_server<span class="token punctuation">{</span>
	ip_hash;
    server <span class="token punctuation">{</span>$本机IP<span class="token punctuation">}</span><span class="token punctuation">:</span>8080;
    server <span class="token punctuation">{</span>$本机IP<span class="token punctuation">}</span><span class="token punctuation">:</span>8081;
<span class="token punctuation">}</span>
server <span class="token punctuation">{</span>
    listen       80;
    listen  <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>80;
    server_name  localhost;

	location / <span class="token punctuation">{</span>
        proxy_pass http<span class="token punctuation">:</span>//<span class="token punctuation">{</span>$upstream的名字<span class="token punctuation">}</span>/;	<span class="token comment">#tomcat首页</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_5-4-健康检查-检查是否有服务器处于异常状态"><a href="#_5-4-健康检查-检查是否有服务器处于异常状态" class="header-anchor">#</a> 5.4， 健康检查： 检查是否有服务器处于异常状态</h4> <p>Nginx 自带 ngx_http_upstream_module（健康检测模块）本质上服务器心跳的检查，通过定期轮询向集群里的服务器发送健康检查请求,来检查集群中是否有服务器处于异常状态；</p> <p>如果某台服务器异常，客户端请求nginx反向代理进来的都不会被发送到该服务器上（直至下次轮训健康检查正常）</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>upstream backserver<span class="token punctuation">{</span>
  server 192.168.0.1  max_fails=1 fail_timeout=40s;
  server 192.168.0.2  max_fails=1 fail_timeout=40s;
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol><li><code>fail_timeout</code> : 设定服务器被认为不可用的时间段以及统计失败尝试次数的时间段，默认为10s</li> <li><code>max_fails</code> : 设定Nginx与服务器通信的尝试失败的次数，默认为：1次</li></ol> <hr> <hr> <h2 id="_6-nginx动静分离"><a href="#_6-nginx动静分离" class="header-anchor">#</a> 6.  Nginx动静分离</h2> <h4 id="_6-1-nginx动静分离-知识点"><a href="#_6-1-nginx动静分离-知识点" class="header-anchor">#</a> 6.1  Nginx动静分离 --- 知识点</h4> <p>Nginx的并发能力公式：</p> <p><code>worker_processes * worker_connections / 4 | 2 = Nginx最终的并发能力</code></p> <p>动态资源需要/4，静态资源需要/2
Nginx通过动静分离来提升Nginx的并发能力，更快的给用户响应</p> <p>==动态资源代理==</p> <p><code>location / { proxy_pass 路径; }</code></p> <p>==静态资源代理==</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>location  /  <span class="token punctuation">{</span>
    root  静态资源路径;
    index  默认访问路径下的什么资源;
    autoindex on;  <span class="token comment">#代表展示静态资源的全部内容，以列表的形式展开</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_6-2-nginx动静分离-案例"><a href="#_6-2-nginx动静分离-案例" class="header-anchor">#</a> 6.2  Nginx动静分离 --- 案例</h4> <p>步骤：</p> <ol><li><p>停掉nginx： <code>docker-compose down</code> ;</p></li> <li><p>修改 <code>/opt/docker_nginx/docker-compose.yml</code> 添加静态资源数据卷，映射到nginx服务器的一个目录</p></li></ol> <p>volumes:
-  /opt/docker_nginx/conf.d/:/etc/nginx/conf.d
-  /opt/docker_nginx/html/:/data/html
-  /opt/docker_nginx/img/:/data/img</p> <ol start="3"><li><p>创建nginx： <code>docker-compose up -d</code> ;</p></li> <li><p>在 /opt/docker_nginx/html/ 目录下创建并编辑： <code>vi index.html</code>  ;
在 /opt/docker_nginx/img/ 目录下ftp  放入一张图片： 	<code>mv 1.jpg /opt/docker_nginx/img/</code>  ;</p></li> <li><p>修改配置文件   <code>/opt/docker_nginx/conf.d/default.conf</code></p></li></ol> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># 代理到html静态资源</span>
location /html <span class="token punctuation">{</span>
   	root  /data;
    index  index.html;
<span class="token punctuation">}</span>
<span class="token comment"># 代理到 img 静态资源</span>
location /img <span class="token punctuation">{</span>
   	root  /data;
    autoindex  on;   <span class="token comment"># 列表的形式展示</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="6"><li>重启nginx：  <code>docker-compose restart</code>
访问<code>{$本机IP}/html</code>   查看 html静态资源，访问<code>{$本机IP}/img</code>   查看 img静态资源</li></ol> <hr> <hr> <h2 id="_7-nginx集群"><a href="#_7-nginx集群" class="header-anchor">#</a> 7.  Nginx集群</h2> <p>单点故障，避免nginx的宕机，导致整个程序的崩溃
准备多台Nginx
准备keepalived，监听nginx的健康情况
准备haproxy，提供一个虚拟的路径，统一的去接收用户的请求</p> <p><img src="https://img-blog.csdnimg.cn/20201103095826308.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ltYWdlX2Z6eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><hr> <hr><p></p> <h2 id="_8-nginx之前端相关配置"><a href="#_8-nginx之前端相关配置" class="header-anchor">#</a> 8.  Nginx之前端相关配置</h2> <p><a href="https://mp.weixin.qq.com/s/MovMnSaqAPLoJuZleiQZUQ" target="_blank" rel="noopener noreferrer">参考111<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="_8-1-适配pc与移动环境"><a href="#_8-1-适配pc与移动环境" class="header-anchor">#</a> 8.1  适配PC与移动环境</h4> <p>当用户从移动端打开PC端baidu.com的场景时，将自动跳转指移动端m.baidu.com，本质上是Nginx可以通过内置变量<code>$http_user_agent</code>，获取到请求客户端的userAgent，从而知道当前用户当前终端是移动端还是PC，进而重定向到H5站还是PC站</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>server <span class="token punctuation">{</span>
  location / <span class="token punctuation">{</span>
    if ($http_user_agent ~* '(Android<span class="token punctuation">|</span>webOS<span class="token punctuation">|</span>iPhone)') <span class="token punctuation">{</span>  <span class="token comment"># 移动、pc设备agent获取</span>
      set $mobile_request '1';
    <span class="token punctuation">}</span>
    if ($mobile_request = '1') <span class="token punctuation">{</span>
      rewrite ^.+ http<span class="token punctuation">:</span>//m.baidu.com;
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><hr> <h4 id="_8-2-配置gzip"><a href="#_8-2-配置gzip" class="header-anchor">#</a> 8.2  配置gzip</h4> <p>开启Nginx gzip，压缩后，静态资源的大小会大大的减少，从而可以节约大量的带宽,提高传输效率，带来更好的响应和体验</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>server<span class="token punctuation">{</span>
  gzip on; //启动
  gzip_buffers 32 4K;
  gzip_comp_level 6; //压缩级别，1<span class="token punctuation">-</span>10，数字越大压缩的越好
  gzip_min_length 100; //不压缩临界值，大于100的才压缩，一般不用改
  gzip_types application/javascript text/css text/xml;
  gzip_disable &quot;MSIE <span class="token punctuation">[</span>1<span class="token punctuation">-</span><span class="token number">6</span><span class="token punctuation">]</span>\.&quot;; // IE6对Gzip不友好，对Gzip
  gzip_vary on;
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr> <h4 id="_8-3-nginx配置跨域请求"><a href="#_8-3-nginx配置跨域请求" class="header-anchor">#</a> 8.3  Nginx配置跨域请求</h4> <p>==403跨域错误==</p> <p>当出现403跨域错误的时候，还有 <code>No 'Access-Control-Allow-Origin' header is present on the requested resource</code> 报错等，需要给Nginx服务器配置响应的header参数：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>location / <span class="token punctuation">{</span>
  add_header Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Origin <span class="token important">*;</span>
  add_header Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Methods 'GET<span class="token punctuation">,</span> POST<span class="token punctuation">,</span> OPTIONS';
  add_header Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Headers 'DNT<span class="token punctuation">,</span>X<span class="token punctuation">-</span>Mx<span class="token punctuation">-</span>ReqToken<span class="token punctuation">,</span>Keep<span class="token punctuation">-</span>Alive<span class="token punctuation">,</span>User<span class="token punctuation">-</span>Agent<span class="token punctuation">,</span>X<span class="token punctuation">-</span>Requested<span class="token punctuation">-</span>With<span class="token punctuation">,</span>If<span class="token punctuation">-</span>Modified<span class="token punctuation">-</span>Since<span class="token punctuation">,</span>Cache<span class="token punctuation">-</span>Control<span class="token punctuation">,</span>Content<span class="token punctuation">-</span>Type<span class="token punctuation">,</span>Authorization';

  if ($request_method = 'OPTIONS') <span class="token punctuation">{</span>
    return 204;
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>==跨域代理==</p> <p>需求背景： 以vue-cli构建后的项目，打包后生产静态文件，其中有个index.html文件。</p> <p>在开发模式下，我们可以通过devServer下的proxy来代理跨域，然后，打包后，打开index.html, devServer可不会执行。这个时候我们便可通过nginx代理跨域, 如下：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">#请求跨域，这里约定代理请求url path是以/api/开头</span>
location ^~/api/ <span class="token punctuation">{</span>
  rewrite ^/api/(.<span class="token important">*)$</span> /$1 break;
  proxy_pass 172.183.23.4;
<span class="token punctuation">}</span>
<span class="token comment"># 这里重写了请求，将正则匹配中的第一个()中$1的path，</span>
<span class="token comment"># 拼接到真正的请求后面，并用break停止后续匹配</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如本地请求时<code>localhost/api/getList</code>, 经过nginx跨域代理，实际请求地址为 <code>172.183.23.4/getList</code>，实现跨域代理</p> <hr> <h4 id="_8-4-nginx-配置https-ssl-认证"><a href="#_8-4-nginx-配置https-ssl-认证" class="header-anchor">#</a> 8.4  Nginx 配置Https -- SSL 认证</h4> <p>两个步骤：签署第三方可信任的 SSL 证书 和 配置 HTTPS</p> <ol><li>==签署第三方可信任的 SSL==</li></ol> <p>配置 HTTPS 要用到私钥 example.key 文件和 example.crt 证书文件，而申请证书文件的时候要用到 example.csr 文件</p> <p>1）生成密钥 .key :
<code>openssl genrsa -out nginx_quick.key 1024</code></p> <p>2）生成证书签名请求文件 .csr ：
<code>openssl req -new -key nginx_quick.key -out nginx_quick.csr</code></p> <p>3）生成证书签名文件 .crt :：
<code>openssl x509 -req -days 3650 -in nginx_quick.csr -signkey nginx_quick.key -out nginx_quick.crt</code></p> <ol start="2"><li>==Nginx配置https==</li></ol> <p>要开启 HTTPS 服务，在配置文件信息块(server)，必须使用监听命令 listen 的 ssl 参数和定义服务器证书文件和私钥文件</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>server <span class="token punctuation">{</span>
  <span class="token comment">#ssl参数</span>
  listen              443 ssl;   <span class="token comment"># 监听443端口，因为443端口是https的默认端口。80为http的默认端口</span>
  server_name         example.com;
  ssl_certificate     /etc/nginx/ssl_cert/nginx_quick.crt;    <span class="token comment">#证书文件---证书的绝对路径</span>
  ssl_certificate_key /etc/nginx/ssl_cert/nginx_quick.key;    <span class="token comment">#私钥文件---密钥的绝对路径</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="3"><li>==修改 docker-compose.yml： 把自定义证书文件传到 Nginx 的对应路径下==</li></ol> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx</span><span class="token punctuation">:</span> <span class="token comment"># 服务的名称</span>

    <span class="token key atrule">volumes</span><span class="token punctuation">:</span> <span class="token comment"># 文件夹映射</span>
      <span class="token punctuation">-</span> ./nginx/nginx.conf<span class="token punctuation">:</span>/etc/nginx/nginx.conf <span class="token comment"># nginx 配置文件</span>
      <span class="token punctuation">-</span> ./nginx/ssl_cert<span class="token punctuation">:</span>/etc/nginx/ssl_cert <span class="token comment"># 证书文件</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span> <span class="token comment"># 端口转发</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;443:443&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>重启后访问 <code>https://localhost</code>，发现页面被 Chrome 标记为不安全访问，这是因为自签证书是无效证书导致的，点击「继续前往」可正常访问到页面：</p> <hr> <h4 id="_8-5-页面缓存-代理缓存"><a href="#_8-5-页面缓存-代理缓存" class="header-anchor">#</a> 8.5  页面缓存 --- 代理缓存</h4> <p>页面缓存主要分为三类：客户端缓存、代理缓存、服务端缓存</p> <p>当 Nginx 做代理时，假如接收的大多是一些响应数据不怎么变化的请求，比如静态资源请求，使用 Nginx 缓存将大幅度提升请求速度。</p> <p>Nginx 中的缓存是以文件系统上的分层数据存储的形式实现的，缓存键可配置，并且可以使用不同的特定于请求的参数来控制进入缓存的内容。</p> <p>Nginx 利用 <code>proxy_cache_path</code> 和 <code>proxy_cache</code> 来开启内容缓存，前者用来设置缓存的路径和配置，后者用来启用缓存</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>http <span class="token punctuation">{</span>
  proxy_cache_path /data/nginx/cache levels=1<span class="token punctuation">:</span>2 keys_zone=mycache<span class="token punctuation">:</span>10m max_size=10g inactive=60m;

  server <span class="token punctuation">{</span>
    proxy_cache mycache;
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上边设置了一个缓存 mycache，并在 server 中启用：</p> <p>1）<code>/data/nginx/cache</code> 指定了本地缓存的根目录；</p> <p>2）<code>level</code> 代表缓存目录结构是两层的，最多设置3层，数字代表命名长度，比如 1:2 就会生成诸如 /data/nginx/cache/w/0d 的目录，对于大量缓存场景，合理的分层缓存是必要的；</p> <p>3）<code>keys_zone</code> 设置了一个共享内存区，10m 代表内存区的大小，该内存区用于存储缓存键和元数据，保证 Nginx 在不检索磁盘的情况下能够快速判断出缓存是否命中；</p> <p>4）<code>max_size</code>  设置了缓存的上限，默认是不限制；</p> <p>5）<code>inactive</code>  设置了缓存在未被访问时能够持续保留的最长时间，也就是失活时间。</p> <hr> <h4 id="_8-6-nginx-替换前端页面的样式"><a href="#_8-6-nginx-替换前端页面的样式" class="header-anchor">#</a> 8.6  Nginx 替换前端页面的样式</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>location / <span class="token punctuation">{</span>
    root /usr/share/nginx/html;
    index index.html index.htm;
    try_files $uri $uri/ /index.html;
    proxy_ssl_verify off;
    <span class="token comment"># 第一个参数是要被替换的，第二个参数是替换后的</span>
    sub_filter '&lt;/head<span class="token punctuation">&gt;</span>' '&lt;/head<span class="token punctuation">&gt;</span> &lt;style<span class="token punctuation">&gt;</span>.el<span class="token punctuation">-</span>container <span class="token punctuation">&gt;</span> .el<span class="token punctuation">-</span>aside<span class="token punctuation">,</span> .el<span class="token punctuation">-</span>container <span class="token punctuation">&gt;</span> .el<span class="token punctuation">-</span>header<span class="token punctuation">{</span><span class="token key atrule">display</span><span class="token punctuation">:</span> none;<span class="token punctuation">}</span>&lt;/style<span class="token punctuation">&gt;</span>';
    sub_filter_once off; <span class="token comment">#替换所有的，默认是on，替换第一个</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="_9-nginx简单总结"><a href="#_9-nginx简单总结" class="header-anchor">#</a> 9.  Nginx简单总结</h2> <p>==nginx  替换 样式（头部、左侧导航菜单）==</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>location <span class="token operator">/</span> <span class="token punctuation">{</span>
        root <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>
        index index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
        proxy_ssl_verify off<span class="token punctuation">;</span>
        # 第一个参数是要被替换的，第二个参数是替换后的
        sub_filter <span class="token string">'&lt;/head&gt;'</span> <span class="token string">'&lt;/head&gt; &lt;style&gt;.el-container &gt; .el-aside, .el-container &gt; .el-header{display: none;}&lt;/style&gt;'</span><span class="token punctuation">;</span>
        sub_filter_once off<span class="token punctuation">;</span> #替换所有的，默认是on，替换第一个
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/20200826191712594.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ltYWdlX2Z6eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p> <p><img src="https://img-blog.csdnimg.cn/202008261923015.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ltYWdlX2Z6eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p> <p><img src="https://img-blog.csdnimg.cn/20200826192651898.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ltYWdlX2Z6eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p> <p><img src="https://img-blog.csdnimg.cn/20200826193911528.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ltYWdlX2Z6eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p> <p>负载均衡</p> <p><img src="https://img-blog.csdnimg.cn/20200826195449834.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ltYWdlX2Z6eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p> <p><img src="https://img-blog.csdnimg.cn/20200826195515367.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ltYWdlX2Z6eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p> <p><img src="https://img-blog.csdnimg.cn/20200826195608366.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ltYWdlX2Z6eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/myBlog/assets/js/app.31a2d7bd.js" defer></script><script src="/myBlog/assets/js/3.76e8c894.js" defer></script><script src="/myBlog/assets/js/1.8243c5f8.js" defer></script><script src="/myBlog/assets/js/14.1a53c00f.js" defer></script>
  </body>
</html>
